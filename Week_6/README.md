Your goal in this project is to break RSA when the public modulus N is generated incorrectly. This should serve as yet another reminder not to implement crypto primitives yourself.

Normally, the primes that comprise an RSA modulus are generated independently of one another. But suppose a developer decides to generate the first prime ppp by choosing a random number RRR and scanning for a prime close by. The second prime qqq is generated by scanning for some other random prime also close to RRR.

We show that the resulting RSA modulus N=pqN = p qN=pq can be easily factored.

Suppose you are given a composite N and are told that N is a product of two relatively close primes ppp and qqq, namely ppp and qqq satisfy

∣p−q∣<2N1/4|p - q| \lt 2 N^{1/4}\quad ∣p−q∣<2N1/4 (*)

Your goal is to factor N.

Let AAA be the arithmetic average of the two primes, that is A=p+q2A = {p+q \over 2}A=2

p+q​. Since ppp and qqq are odd, we know that p+qp+qp+q is even and therefore AAA is an integer.

To factor N you first observe that under condition (*) the quantity N\sqrt{N}N

​ is very close to AAA. In particular, we show below that:

A−N<1A - \sqrt{N} \lt 1A−N

​<1

But since AAA is an integer, rounding N\sqrt{N}N

​ up to the closest integer reveals the value of AAA. In code, A=ceil(sqrt(N))A = \text{ceil}(\text{sqrt}(N))A=ceil(sqrt(N)) where "ceil" is the ceiling function.

Visually, the numbers p,q,Np, q, \sqrt{N}p,q,N

​ and AAA are ordered as follows:

Since AAA is the exact mid-point between ppp and qqq there is an integer xxx such that p=A−xp = A-xp=A−x and q=A+xq = A+xq=A+x.

But then N=pq=(A−x)(A+x)=A2−x2N = p q = (A-x)(A+x) = A^2 - x^2N=pq=(A−x)(A+x)=A2−x2 and therefore x=A2−Nx = \sqrt{A^2-N}x=A2−N

​.

Now, given xxx and AAA you can find the factors ppp and qqq of N since p=A−xp = A-xp=A−x and q=A+xq = A+xq=A+x. You have now factored N N\ N  !

Further reading: the method described above is a greatly simplified version of a much more general result on factoring when the high order bits of the prime factor are known.

In the following challenges, you will factor the given moduli using the method outlined above. To solve this assignment it is best to use an environment that supports multi-precision arithmetic and square roots. In Python you could use the gmpy2 module. In C you can use GMP.